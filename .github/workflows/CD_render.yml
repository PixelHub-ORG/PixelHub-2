# ----------------------------------------------------------------------------
# Deploy on Render Workflow
# This workflow triggers a deployment webhook in render only after the "Pytest"
# workflow has successfully completed on the main branch.
# ----------------------------------------------------------------------------

name: Deploy on Render

on:
  workflow_run:
    # Trigger this workflow only after "Pytest" completes
    workflows: 
      - "Pytest"
    types:
      - completed

jobs:
  deploy:
    # Run deployment only if the tests succeeded AND we're on the main branch
    if: github.event.workflow_run.conclusion == 'success' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-24.04

    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Deploy to Render
        env:
          deploy_url: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        run: |
          curl "$deploy_url"
